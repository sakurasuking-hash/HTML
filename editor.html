<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8" />
	<title>ç»„åˆäº§å“ç¼–è¾‘é¡µ - åå°äº¤äº’åŸå‹</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<style>
		:root {
			--primary: #1976d2;
			--primary-dark: #115293;
			--primary-light: #e3f2fd;
			--accent: #ff9800;
			--error: #d32f2f;
			--bg: #fafafa;
			--border: #e0e0e0;
			--text-main: #212121;
			--text-sub: #757575;
			--radius: 8px;
			--shadow-1: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
			--shadow-2: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
		}

		*,
		*::before,
		*::after {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			padding: 0;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			background: var(--bg);
			color: var(--text-main);
		}

		.app-shell {
			display: flex;
			min-height: 100vh;
		}

		/* å·¦ä¾§å¯¼èˆªå ä½ï¼ˆéé‡ç‚¹ï¼Œä»…ç¤ºæ„ï¼‰ */
		.nav {
			width: 220px;
			background: #111827;
			color: #e5e7eb;
			padding: 16px 0;
		}

		.nav-header {
			padding: 0 24px 16px;
			font-size: 18px;
			font-weight: 600;
		}

		.nav-section-title {
			padding: 8px 24px;
			font-size: 12px;
			text-transform: uppercase;
			color: #9ca3af;
		}

		.nav-item {
			padding: 8px 24px;
			display: flex;
			align-items: center;
			font-size: 14px;
			color: #d1d5db;
			cursor: pointer;
		}

		.nav-item.active {
			background: rgba(59, 130, 246, 0.2);
			color: #fff;
		}

		.nav-item span.icon {
			display: inline-block;
			width: 18px;
			margin-right: 12px;
			text-align: center;
		}

		main {
			flex: 1;
			padding: 24px 32px 32px;
			overflow: auto;
		}

		header.page-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 16px;
		}

		.breadcrumbs {
			font-size: 13px;
			color: var(--text-sub);
			margin-bottom: 4px;
		}

		.breadcrumbs span {
			cursor: default;
		}

		.breadcrumbs .divider {
			margin: 0 4px;
		}

		.page-title {
			font-size: 22px;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.page-title-badge {
			display: inline-flex;
			align-items: center;
			padding: 2px 8px;
			border-radius: 999px;
			background: #e8f5e9;
			color: #2e7d32;
			font-size: 11px;
		}

		.chip {
			display: inline-flex;
			align-items: center;
			padding: 2px 10px;
			border-radius: 999px;
			font-size: 11px;
			background: #e3f2fd;
			color: #1565c0;
			margin-left: 8px;
		}

		.page-header-actions {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 13px;
			color: var(--text-sub);
		}

		.status-pill {
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 4px 10px;
			border-radius: 999px;
			background: #fff3e0;
			color: #ef6c00;
			font-size: 12px;
		}

		.status-dot {
			width: 8px;
			height: 8px;
			border-radius: 999px;
			background: #ef6c00;
		}

		.helper-text-inline {
			font-size: 12px;
			color: var(--text-sub);
		}

		/* é¡¶éƒ¨æç¤º / é”™è¯¯æ  */
		.info-banner {
			display: none;
			margin-bottom: 16px;
			padding: 10px 12px;
			border-radius: var(--radius);
			font-size: 13px;
			align-items: center;
			gap: 8px;
		}

		.info-banner.visible {
			display: flex;
		}

		.info-banner.error {
			background: #ffebee;
			color: var(--error);
			border: 1px solid #ffcdd2;
		}

		.info-banner.success {
			background: #e8f5e9;
			color: #2e7d32;
			border: 1px solid #c8e6c9;
		}

		.info-banner .icon {
			font-size: 18px;
		}

		.info-banner .message {
			flex: 1;
		}

		.info-banner .link {
			color: var(--primary);
			cursor: pointer;
			text-decoration: underline;
		}

		/* å¡ç‰‡å¸ƒå±€ */
		.card {
			background: #fff;
			border-radius: var(--radius);
			box-shadow: var(--shadow-1);
			padding: 20px 24px 16px;
			margin-bottom: 16px;
		}

		.card-header {
			display: flex;
			justify-content: space-between;
			align-items: baseline;
			margin-bottom: 12px;
		}

		.card-title {
			font-size: 16px;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.card-subtitle {
			font-size: 12px;
			color: var(--text-sub);
		}

		.required-dot {
			color: var(--error);
			margin-left: 2px;
		}

		.section-divider {
			height: 1px;
			background: var(--border);
			margin: 8px 0 16px;
		}

		.form-row {
			display: grid;
			grid-template-columns: repeat(2, minmax(0, 1fr));
			gap: 16px 24px;
		}

		@media (max-width: 960px) {
			.nav {
				display: none;
			}

			main {
				padding: 16px;
			}

			.form-row {
				grid-template-columns: minmax(0, 1fr);
			}
		}

		.form-field {
			display: flex;
			flex-direction: column;
			position: relative;
		}

		.label-row {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 4px;
		}

		label {
			font-size: 13px;
			color: var(--text-main);
		}

		label .required {
			color: var(--error);
			margin-left: 2px;
		}

		label .tag {
			display: inline-flex;
			align-items: center;
			padding: 1px 6px;
			border-radius: 4px;
			background: #f3f4f6;
			font-size: 11px;
			color: var(--text-sub);
			margin-left: 6px;
		}

		.input,
		.select,
		.textarea {
			width: 100%;
			padding: 10px 12px;
			font-size: 13px;
			border-radius: 4px;
			border: 1px solid var(--border);
			background: #fff;
			color: var(--text-main);
			outline: none;
			transition: border-color 0.15s ease, box-shadow 0.15s ease;
		}

		.input:focus,
		.select:focus,
		.textarea:focus {
			border-color: var(--primary);
			box-shadow: 0 0 0 1px rgba(25, 118, 210, 0.2);
		}

		.input.error,
		.select.error,
		.textarea.error {
			border-color: var(--error);
			box-shadow: 0 0 0 1px rgba(211, 47, 47, 0.2);
		}

		.textarea {
			min-height: 96px;
			resize: vertical;
		}

		.helper-text {
			font-size: 12px;
			color: var(--text-sub);
			margin-top: 4px;
		}

		.error-text {
			font-size: 12px;
			color: var(--error);
			margin-top: 4px;
		}

		/* ç»„åˆæ„æˆè¡¨æ ¼ */
		.table-wrapper {
			border-radius: 6px;
			border: 1px solid var(--border);
			overflow: hidden;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			font-size: 13px;
		}

		thead {
			background: #f5f5f5;
		}

		th,
		td {
			padding: 8px 10px;
			text-align: left;
			border-bottom: 1px solid var(--border);
			vertical-align: middle;
		}

		th {
			font-weight: 500;
			color: var(--text-sub);
		}

		tbody tr:nth-child(even) {
			background: #fafafa;
		}

		tbody tr:last-child td {
			border-bottom: none;
		}

		.table-input {
			width: 100%;
			padding: 6px 8px;
			font-size: 12px;
			border-radius: 4px;
			border: 1px solid var(--border);
			outline: none;
		}

		.table-input[readonly] {
			background: #f9fafb;
			color: var(--text-sub);
		}

		.badge {
			display: inline-flex;
			align-items: center;
			padding: 2px 8px;
			border-radius: 999px;
			font-size: 11px;
			background: #e3f2fd;
			color: #1565c0;
		}

		.badge-muted {
			background: #f3f4f6;
			color: var(--text-sub);
		}

		.badge-success {
			background: #e8f5e9;
			color: #2e7d32;
		}

		.badge-warning {
			background: #fff3e0;
			color: #ef6c00;
		}

		.badge-error {
			background: #ffebee;
			color: var(--error);
		}

		.chip-compact {
			display: inline-flex;
			align-items: center;
			padding: 0 6px;
			border-radius: 999px;
			font-size: 10px;
			background: #e0f2f1;
			color: #00695c;
			margin-left: 4px;
		}

		.chip-compact.error {
			background: #ffebee;
			color: #c62828;
		}

		/* è¡¨æ ¼å†…æŒ‰é’® */
		.btn-text {
			display: inline-flex;
			align-items: center;
			border: none;
			background: transparent;
			padding: 2px 6px;
			color: var(--primary);
			font-size: 12px;
			border-radius: 4px;
			cursor: pointer;
		}

		.btn-text:hover {
			background: rgba(25, 118, 210, 0.04);
		}

		.btn-text-danger {
			color: var(--error);
		}

		.btn-text-danger:hover {
			background: rgba(211, 47, 47, 0.04);
		}

		.btn-chip {
			display: inline-flex;
			align-items: center;
			padding: 2px 8px;
			border-radius: 999px;
			border: 1px dashed var(--border);
			background: #fafafa;
			color: var(--text-sub);
			font-size: 12px;
			cursor: pointer;
		}

		.btn-chip:hover {
			background: #f3f4f6;
		}

		.btn-icon {
			border: none;
			background: transparent;
			cursor: pointer;
			width: 28px;
			height: 28px;
			border-radius: 50%;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			color: var(--text-sub);
		}

		.btn-icon:hover {
			background: rgba(0, 0, 0, 0.04);
		}

		.btn-icon[disabled] {
			opacity: 0.4;
			cursor: default;
		}

		/* æƒé‡æ±‡æ€» */
		.weight-summary {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 8px 10px;
			background: #fafafa;
			border-top: 1px solid var(--border);
			font-size: 12px;
		}

		.weight-total {
			display: inline-flex;
			align-items: baseline;
			gap: 4px;
		}

		.weight-total span.value {
			font-weight: 600;
		}

		.weight-total.ok span.value {
			color: #2e7d32;
		}

		.weight-total.error span.value {
			color: var(--error);
		}

		.weight-hint {
			color: var(--text-sub);
		}

		/* åº•éƒ¨æ“ä½œåŒº */
		.form-footer {
			position: sticky;
			bottom: 0;
			margin-top: 16px;
			padding-top: 12px;
			padding-bottom: 8px;
			background: linear-gradient(to top, rgba(250, 250, 250, 0.98), rgba(250, 250, 250, 0.7));
			border-top: 1px solid rgba(224, 224, 224, 0.8);
			backdrop-filter: blur(6px);
		}

		.form-footer-inner {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.footer-left {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 12px;
			color: var(--text-sub);
		}

		.footer-right {
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.btn {
			border: none;
			border-radius: 4px;
			font-size: 13px;
			padding: 8px 16px;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease;
			white-space: nowrap;
		}

		.btn-primary {
			background: var(--primary);
			color: #fff;
			box-shadow: var(--shadow-1);
		}

		.btn-primary:hover {
			background: var(--primary-dark);
			box-shadow: var(--shadow-2);
		}

		.btn-primary:active {
			transform: translateY(1px);
			box-shadow: none;
		}

		.btn-secondary {
			background: #fff;
			color: var(--primary);
			border: 1px solid rgba(25, 118, 210, 0.4);
		}

		.btn-secondary:hover {
			background: #f5fafe;
		}

		.btn-ghost {
			background: transparent;
			color: var(--text-sub);
		}

		.btn-ghost:hover {
			background: rgba(0, 0, 0, 0.04);
		}

		.btn[disabled] {
			opacity: 0.6;
			cursor: default;
			box-shadow: none;
		}

		.btn span.icon {
			margin-right: 6px;
			font-size: 16px;
		}

		.toggle-group {
			display: inline-flex;
			border-radius: 999px;
			background: #f3f4f6;
			padding: 2px;
		}

		.toggle-chip {
			border: none;
			border-radius: 999px;
			background: transparent;
			padding: 4px 10px;
			font-size: 11px;
			color: var(--text-sub);
			cursor: pointer;
		}

		.toggle-chip.active {
			background: #fff;
			color: #1565c0;
			box-shadow: 0 0 0 1px rgba(25, 118, 210, 0.3);
		}

		/* æ¨¡æ‹Ÿå¼€å…³ */
		.switch {
			position: relative;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			cursor: pointer;
			font-size: 12px;
			color: var(--text-sub);
		}

		.switch input {
			display: none;
		}

		.switch-slider {
			width: 32px;
			height: 18px;
			border-radius: 999px;
			background: #e5e7eb;
			position: relative;
			transition: background 0.15s ease;
		}

		.switch-knob {
			position: absolute;
			top: 2px;
			left: 2px;
			width: 14px;
			height: 14px;
			border-radius: 50%;
			background: #fff;
			box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
			transition: transform 0.15s ease;
		}

		.switch input:checked + .switch-slider {
			background: var(--primary);
		}

		.switch input:checked + .switch-slider .switch-knob {
			transform: translateX(14px);
		}

		/* ç®€æ˜“å¯¹è¯æ¡†ï¼ˆå…¥é‡‘ / å¢åŠ å“ç§ï¼‰ */
		.dialog-backdrop {
			position: fixed;
			inset: 0;
			background: rgba(0, 0, 0, 0.35);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 10;
		}

		.dialog-backdrop.visible {
			display: flex;
		}

		.dialog {
			background: #fff;
			border-radius: 8px;
			box-shadow: var(--shadow-2);
			width: 100%;
			max-width: 420px;
			padding: 20px 24px 16px;
			animation: dialog-in 0.18s ease-out;
		}

		@keyframes dialog-in {
			from {
				opacity: 0;
				transform: translateY(8px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.dialog-title {
			font-size: 16px;
			font-weight: 600;
			margin-bottom: 4px;
		}

		.dialog-desc {
			font-size: 13px;
			color: var(--text-sub);
			margin-bottom: 16px;
		}

		.dialog-footer {
			display: flex;
			justify-content: flex-end;
			gap: 8px;
			margin-top: 16px;
		}

		/* å‘å¸ƒå‰ç¡®è®¤å¼¹çª— */
		.dialog-warning {
			background: #fffde7;
			border-radius: 4px;
			padding: 8px 10px;
			font-size: 12px;
			color: #f57f17;
			display: flex;
			align-items: flex-start;
			gap: 8px;
			margin-bottom: 12px;
		}

		.dialog-warning .icon {
			font-size: 18px;
		}

		.dialog-list {
			margin: 0;
			padding-left: 18px;
			font-size: 12px;
			color: var(--text-sub);
		}

		.dialog-list li {
			margin-bottom: 4px;
		}

		/* ç®€æ˜“æ ‡ç­¾ã€R çº§åˆ«ç­‰ */
		.tag-inline {
			display: inline-flex;
			align-items: center;
			padding: 0 6px;
			border-radius: 999px;
			font-size: 11px;
			background: #ede7f6;
			color: #5e35b1;
			margin-left: 4px;
		}

		.tag-inline.r3 {
			background: #e3f2fd;
			color: #1565c0;
		}

		/* å°æç¤ºå·¥å…·æ¡ */
		.inline-hints {
			display: flex;
			gap: 12px;
			font-size: 11px;
			color: var(--text-sub);
			flex-wrap: wrap;
			margin-top: 4px;
		}
	</style>
</head>
<body>
<div class="app-shell">
	<!-- å·¦ä¾§å¯¼èˆªå ä½ï¼šç­–ç•¥ç®¡ç†å¹³å° - äº§å“åˆ—è¡¨ -->
        <aside class="nav">
            <div class="nav-header">ç­–ç•¥ç®¡ç†å¹³å°</div>
            <div class="nav-section-title">äº§å“ç®¡ç†</div>
            <div class="nav-item">
                <span class="icon">ğŸ“„</span>
                <span>å•å“ç§ç­–ç•¥åˆ—è¡¨</span>
            </div>
            <div class="nav-item active">
                <span class="icon">ğŸ“Š</span>
                <span>ç»„åˆäº§å“åˆ—è¡¨</span>
            </div>
            <div class="nav-item">
                <span class="icon">âš™ï¸</span>
                <span>ç³»åˆ—ä¸ç­¾çº¦é…ç½®</span>
            </div>
        </aside>

	<main>
		<header class="page-header">
			<div>
				<div class="breadcrumbs">
					<span>ç­–ç•¥ç®¡ç†å¹³å°</span>
					<span class="divider">/</span>
					<span>äº§å“åˆ—è¡¨</span>
					<span class="divider">/</span>
					<span>ç»„åˆäº§å“ç¼–è¾‘</span>
				</div>
				<div class="page-title">
					<span id="pageTitleText">çŸ¿é‡‘ä¼˜é€‰12å·-ç‡ƒæ–™æ²¹FU</span>
					<span class="page-title-badge">
						ç»„åˆç­–ç•¥ Â· é‡åŒ–ä¿¡å·ç±»
					</span>
					<span class="chip">
						å½“å‰ä¸ºè‰ç¨¿
					</span>
				</div>
			</div>
			<div class="page-header-actions">
				<div class="status-pill" id="statusPill">
					<span class="status-dot"></span>
					<span id="statusPillText">è‰ç¨¿ Â· æœªå‘å¸ƒ</span>
				</div>
			</div>
		</header>

		<!-- é¡¶éƒ¨ä¿¡æ¯æ¡ï¼šç”¨äºå±•ç¤ºæ ¡éªŒé”™è¯¯æˆ–æˆåŠŸæç¤º -->
		<div id="banner" class="info-banner">
			<div class="icon">â„¹ï¸</div>
			<div class="message" id="bannerMessage"></div>
			<div class="link" id="scrollToErrorLink" style="display:none;">æŸ¥çœ‹è¯¦æƒ…</div>
		</div>

		<!-- 4.1 åŸºç¡€ä¿¡æ¯åŒº -->
		<section class="card" id="basicInfoCard">
			<div class="card-header">
				<div>
					<div class="card-title">
						åŸºç¡€ä¿¡æ¯
						<span class="required-dot">Â· å¿…å¡«æ ¸å¿ƒ</span>
					</div>
					<div class="card-subtitle">
						ç”¨äºå‰ç«¯å±•ç¤ºã€ç­¾çº¦å’Œåˆè§„æ ¡éªŒçš„åŸºç¡€å­—æ®µ
					</div>
				</div>
				<div class="helper-text-inline">
					<span>äº§å“ç¼–å·ä¸€æ—¦å‘å¸ƒåä»…æ”¯æŒåªè¯»æŸ¥çœ‹</span>
				</div>
			</div>
			<div class="section-divider"></div>

			<div class="form-row">
				<!-- äº§å“åç§° -->
				<div class="form-field">
					<div class="label-row">
						<label for="productName">
							äº§å“åç§°<span class="required">*</span>
						</label>
						<span class="helper-text-inline">å‰ç«¯åˆ—è¡¨ & è¯¦æƒ…é¡µä¸»æ ‡é¢˜</span>
					</div>
					<input
						id="productName"
						class="input"
						type="text"
						placeholder="ä¾‹å¦‚ï¼šçŸ¿é‡‘ä¼˜é€‰12å·-ç‡ƒæ–™æ²¹FU"
						value="çŸ¿é‡‘ä¼˜é€‰12å·-ç‡ƒæ–™æ²¹FU"
						required
					/>
					<div class="helper-text">
						å»ºè®®æ ¼å¼ï¼šç³»åˆ—åç§° + æœŸå· + æ ¸å¿ƒå“ç§ï¼Œä¾¿äºå‰ç«¯ç»Ÿä¸€å±•ç¤º
					</div>
					<div class="error-text" data-error-for="productName"></div>
				</div>

				<!-- äº§å“ç¼–å· -->
				<div class="form-field">
					<div class="label-row">
						<label for="productCode">
							äº§å“ç¼–å·<span class="required">*</span>
							<span class="tag">ç³»ç»Ÿç”Ÿæˆ / åªè¯»</span>
						</label>
					</div>
					<input
						id="productCode"
						class="input"
						type="text"
						value="WK001220251022"
						readonly
					/>
					<div class="helper-text">
						ç”¨äºå¯¹æ¥å¤–éƒ¨ç³»ç»Ÿä¸å†…éƒ¨æ•°æ®è¡¨ï¼Œç¡®ä¿å”¯ä¸€ä¸”ä¸å¯é‡å¤
					</div>
					<div class="error-text" data-error-for="productCode"></div>
				</div>

				<!-- é£é™©ç­‰çº§ -->
				<div class="form-field">
					<div class="label-row">
						<label for="riskLevel">
							é£é™©ç­‰çº§<span class="required">*</span>
						</label>
						<span class="helper-text-inline">å½±å“å‰ç«¯åˆè§„æç¤ºä¸ç­¾çº¦è¦æ±‚</span>
					</div>
					<select id="riskLevel" class="select" required>
						<option value="">è¯·é€‰æ‹©</option>
						<option value="R1">R1</option>
						<option value="R2">R2</option>
						<option value="R3" selected>R3</option>
						<option value="R4">R4</option>
					</select>
					<div class="helper-text">
						ä¸å…¬å¸é£é™©è¯„çº§ä½“ç³»ä¿æŒä¸€è‡´ï¼Œå¦‚ R1 / R2 / R3 / R4
					</div>
					<div class="error-text" data-error-for="riskLevel"></div>
				</div>

				<!-- äº§å“ç±»å‹ -->
				<div class="form-field">
					<div class="label-row">
						<label for="productType">
							äº§å“ç±»å‹<span class="required">*</span>
						</label>
						<span class="helper-text-inline">å½±å“åç»­å¯é€‰çš„äº§å“å½¢å¼</span>
					</div>
					<select id="productType" class="select" required>
						<option value="">è¯·é€‰æ‹©</option>
						<option value="é‡åŒ–ä¿¡å·ç±»" selected>é‡åŒ–ä¿¡å·ç±»</option>
						<option value="æŠ•ç ”èµ„è®¯æœåŠ¡ç±»">æŠ•ç ”èµ„è®¯æœåŠ¡ç±»</option>
						<option value="åŸ¹è®­è¯¾ç¨‹ç±»">åŸ¹è®­è¯¾ç¨‹ç±»</option>
						<option value="ä¸»è§‚ç­–ç•¥ç±»">ä¸»è§‚ç­–ç•¥ç±»</option>
						<option value="ä¿¡æ¯æœåŠ¡ç±»">ä¿¡æ¯æœåŠ¡ç±»</option>
						<option value="å…¶ä»–">å…¶ä»–</option>
					</select>
					<div class="helper-text">
						ä¸‹æ‹‰é€‰é¡¹ä¸ç°æœ‰äº§å“åˆ†ç±»ä¿æŒä¸€è‡´
					</div>
					<div class="error-text" data-error-for="productType"></div>
				</div>

				<!-- äº§å“å‡ºå“äºº -->
				<div class="form-field">
					<div class="label-row">
						<label for="producer">
							äº§å“å‡ºå“äºº<span class="required">*</span>
						</label>
						<span class="helper-text-inline">å‰ç«¯å±•ç¤º & è´£ä»»å½’å±</span>
					</div>
					<input
						id="producer"
						class="input"
						type="text"
						placeholder="ä¾‹å¦‚ï¼šäº”çŸ¿æœŸè´§æŠ•èµ„å’¨è¯¢å›¢é˜Ÿ"
						value="äº”çŸ¿æœŸè´§æŠ•èµ„å’¨è¯¢å›¢é˜Ÿ"
						required
					/>
					<div class="helper-text">
						å¯ä¸ºå›¢é˜Ÿåç§°æˆ–æŠ•é¡¾åç§°ï¼Œéœ€ä¸ä»ä¸šèµ„æ ¼å…¬ç¤ºä¿¡æ¯å¯¹åº”
					</div>
					<div class="error-text" data-error-for="producer"></div>
				</div>

				<!-- äº§å“ç­‰çº§ -->
				<div class="form-field">
					<div class="label-row">
						<label for="productLevel">
							äº§å“ç­‰çº§
						</label>
						<span class="helper-text-inline">ç”¨äºå‰ç«¯æ ‡ç­¾ä¸äººç¾¤å®šä½</span>
					</div>
					<select id="productLevel" class="select">
						<option value="">å¯é€‰</option>
						<option value="åˆçº§">åˆçº§</option>
						<option value="ä¸­çº§" selected>ä¸­çº§</option>
						<option value="é«˜çº§">é«˜çº§</option>
					</select>
					<div class="helper-text">
						ç¤ºä¾‹ï¼šåˆçº§ / ä¸­çº§ / é«˜çº§ï¼Œç”¨äºæ ‡ç­¾æˆ–ç­›é€‰
					</div>
					<div class="error-text" data-error-for="productLevel"></div>
				</div>

				<!-- æ‰€å±ç³»åˆ— -->
				<div class="form-field">
					<div class="label-row">
						<label for="series">
							æ‰€å±ç³»åˆ—<span class="required">*</span>
						</label>
						<span class="helper-text-inline">ç”¨äºç­¾çº¦å…³è”</span>
					</div>
					<select id="series" class="select" required>
						<option value="">è¯·é€‰æ‹©</option>
						<option value="çŸ¿é‡‘ä¼˜é€‰ï¼ˆR3ï¼‰" selected>çŸ¿é‡‘ä¼˜é€‰ï¼ˆR3ï¼‰</option>
						<option value="çŸ¿é‡‘æ™ºé€‰ï¼ˆR3ï¼‰">çŸ¿é‡‘æ™ºé€‰ï¼ˆR3ï¼‰</option>
						<option value="çŸ¿è€€ç³»åˆ—ï¼ˆR4ï¼‰">çŸ¿è€€ç³»åˆ—ï¼ˆR4ï¼‰</option>
						<option value="è‡ªå®šä¹‰ç³»åˆ—">è‡ªå®šä¹‰ç³»åˆ—</option>
					</select>
					<div class="helper-text">
						ç»‘å®šåˆ°å·²æœ‰ç³»åˆ—ï¼ˆå¦‚ã€ŒçŸ¿é‡‘ä¼˜é€‰ï¼ˆR3ï¼‰ã€ï¼‰ï¼Œç”¨äºåˆåŒç­¾çº¦ä¸æƒç›Šé…ç½®
					</div>
					<div class="error-text" data-error-for="series"></div>
				</div>

				<!-- äº§å“å½¢å¼ -->
				<div class="form-field">
					<div class="label-row">
						<label for="productForm">
							äº§å“å½¢å¼<span class="required">*</span>
						</label>
						<span class="helper-text-inline">ä¸äº§å“ç±»å‹å­˜åœ¨çº¦æŸå…³ç³»</span>
					</div>
					<select id="productForm" class="select" required>
						<option value="">è¯·é€‰æ‹©</option>
						<option value="å•å“ç§ç­–ç•¥">å•å“ç§ç­–ç•¥</option>
						<option value="ç»„åˆç­–ç•¥" selected>ç»„åˆç­–ç•¥</option>
						<option value="çº¿ä¸Šäº§å“">çº¿ä¸Šäº§å“</option>
						<option value="ç›´æ’­äº§å“">ç›´æ’­äº§å“</option>
						<option value="çº¿ä¸‹äº§å“">çº¿ä¸‹äº§å“</option>
						<option value="åŒèŠ±é¡ºäº§å“">åŒèŠ±é¡ºäº§å“</option>
						<option value="è‡ªå®šä¹‰äº§å“">è‡ªå®šä¹‰äº§å“</option>
					</select>
					<div class="inline-hints">
						<span>é‡åŒ–äº§å“ï¼šå•å“ç§ç­–ç•¥ / ç»„åˆç­–ç•¥ / åŒèŠ±é¡ºæŒ‡æ ‡</span>
					</div>
					<div class="error-text" data-error-for="productForm"></div>
				</div>

				<!-- ç»„åˆç±»å‹ -->
				<div class="form-field">
					<div class="label-row">
						<label for="comboType">
							ç»„åˆç±»å‹<span class="required">*</span>
						</label>
						<span class="helper-text-inline">
							ç¤ºæ„ï¼šç±»å‹1 / ç±»å‹2 / ç±»å‹3
						</span>
					</div>
					<select id="comboType" class="select" required>
						<option value="">è¯·é€‰æ‹©</option>
						<option value="type1" selected>ç±»å‹1ï¼ˆæƒç›Šä»½é¢ + æƒé‡åˆ¶ï¼‰</option>
						<option value="type2">ç±»å‹2ï¼ˆä»…æƒé‡ï¼Œä¸è®¾ä»½é¢ï¼‰</option>
						<option value="type3">ç±»å‹3ï¼ˆå…¶ä»–ç»„åˆé€»è¾‘ï¼‰</option>
					</select>
					<div class="helper-text">
						ä»…å½“ã€Œäº§å“å½¢å¼ = ç»„åˆç­–ç•¥ã€æ—¶éœ€é€‰æ‹©ï¼Œç±»å‹1 æ‰ä¼šå±•ç¤ºç»„åˆæ„æˆä¸æƒé‡åŒº
					</div>
					<div class="error-text" data-error-for="comboType"></div>
				</div>

				<!-- äº§å“ç®€ä»‹ -->
				<div class="form-field" style="grid-column: 1 / -1;">
					<div class="label-row">
						<label for="description">
							äº§å“ç®€ä»‹<span class="required">*</span>
						</label>
						<span class="helper-text-inline">å‰ç«¯è¯¦æƒ…é¡µç›´æ¥å±•ç¤º</span>
					</div>
					<textarea
						id="description"
						class="textarea"
						required
					>æœ¬ç­–ç•¥é‡‡ç”¨åŠ¨æ€æ³¢åŠ¨è¿‡æ»¤ä¸è¶‹åŠ¿æ•æ‰çš„é‡åŒ–æ‹©æ—¶æ¨¡å‹ï¼Œç»“åˆå“ç§åŸºæœ¬é¢ä¸ç›˜é¢ç‰¹å¾ï¼ŒåŠ›æ±‚åœ¨æ§åˆ¶å›æ’¤çš„å‰æä¸‹è·å–ç¨³å¥è¶…é¢æ”¶ç›Šã€‚</textarea>
					<div class="helper-text">
						å»ºè®®åŒ…å«ï¼šæ ¸å¿ƒç­–ç•¥é€»è¾‘ã€é€‚ç”¨äººç¾¤ã€æ”¶ç›Š / é£é™©ç‰¹å¾ç­‰ä¿¡æ¯
					</div>
					<div class="error-text" data-error-for="description"></div>
				</div>
			</div>
		</section>

		<!-- 4.2 ç»„åˆæ„æˆä¸æƒé‡åŒºï¼ˆç»„åˆé‡åŒ–äº§å“é€‚ç”¨ï¼‰ -->
		<section class="card" id="comboSection">
			<div class="card-header">
				<div>
					<div class="card-title">
						ç»„åˆæ„æˆä¸æƒé‡
						<span class="required-dot">Â· ç»„åˆé‡åŒ–äº§å“é€‚ç”¨</span>
					</div>
					<div class="card-subtitle">
						ä»…å½“ã€Œäº§å“å½¢å¼ = ç»„åˆç­–ç•¥ï¼Œä¸”ç»„åˆç±»å‹ä¸ºç±»å‹1ã€æ—¶å±•ç¤ºæœ¬åŒºå—
					</div>
				</div>
				<div>
					<div class="label-row" style="justify-content:flex-end;">
						<span style="font-size:12px;color:var(--text-sub);margin-right:8px;">
							æƒé‡åˆ†é…ç±»å‹
						</span>
						<div class="toggle-group" id="weightTypeToggle">
							<button
								type="button"
								class="toggle-chip active"
								data-weight-type="equal"
							>ç­‰æƒ</button>
							<button
								type="button"
								class="toggle-chip"
								data-weight-type="custom"
							>è‡ªå®šä¹‰</button>
						</div>
					</div>
					<div class="helper-text" style="text-align:right;margin-top:4px;">
						ç­‰æƒï¼šæ–°å¢ / åˆ é™¤å­è…¿æ—¶è‡ªåŠ¨å‡åˆ†ï¼›è‡ªå®šä¹‰ï¼šäººå·¥ç»´æŠ¤æƒé‡æ€»å’Œ = 100%
					</div>
				</div>
			</div>
			<div class="section-divider"></div>

			<div class="form-row" style="margin-bottom:16px;">
				<!-- æ€»æƒç›Š -->
				<div class="form-field">
					<div class="label-row">
						<label for="totalEquity">
							æ€»æƒç›Š<span class="required">*</span>
						</label>
						<span class="helper-text-inline">
							å½“å‰ç»„åˆå®é™…ç®¡ç†èµ„é‡‘è§„æ¨¡
						</span>
					</div>
					<input
						id="totalEquity"
						class="input"
						type="text"
						value="1000000"
					/>
					<div class="helper-text">
						å•ä½ï¼šå…ƒï¼Œæ”¯æŒç‚¹å‡»ã€Œå…¥é‡‘ã€ååŠ¨æ€å¢åŠ ï¼ˆç¤ºä¾‹ï¼šå½“å‰ 100ä¸‡ï¼‰
					</div>
					<div class="error-text" data-error-for="totalEquity"></div>
				</div>

				<!-- ä»½é¢ & å‡€å€¼ï¼ˆç¤ºæ„åªè¯»ï¼‰ -->
				<div class="form-field">
					<div class="label-row">
						<label>
							ä»½é¢ / å‡€å€¼
						</label>
						<span class="helper-text-inline">
							æ ¹æ®æ—¥ç»ˆç»“ç®—ç»“æœè®¡ç®—
						</span>
					</div>
					<div style="display:flex;gap:8px;">
						<input
							id="shareAmount"
							class="input"
							type="text"
							value="1000000"
							readonly
						/>
						<input
							id="nav"
							class="input"
							type="text"
							value="1.0000"
							readonly
						/>
					</div>
					<div class="helper-text">
						å·¦ï¼šå½“å‰æ€»ä»½é¢ï¼›å³ï¼šå½“å‰ç»„åˆå‡€å€¼ï¼ˆç¤ºä¾‹å­—æ®µï¼Œåªè¯»ï¼‰
					</div>
				</div>
			</div>

			<!-- ç­–ç•¥åˆ—è¡¨å’Œæƒé‡è¡¨æ ¼ -->
			<div class="table-wrapper" id="strategyTableWrapper">
				<table>
					<thead>
					<tr>
						<th style="width:12%;">å•è…¿å“ç§</th>
						<th style="width:18%;">å•è…¿äº§å“ID</th>
						<th style="width:14%;">Cmb_id</th>
						<th style="width:14%;">ç»„åˆäº§å“ID</th>
						<th style="width:14%;">æƒç›Š</th>
						<th style="width:12%;">å“ç§æƒé‡æ¯”ä¾‹</th>
						<th style="width:16%;">æ“ä½œ</th>
					</tr>
					</thead>
					<tbody id="strategyTbody">
					<tr data-row-id="1">
						<td>M</td>
						<td>Kuangjinyx03</td>
						<td>Kuangjincmb01</td>
						<td>Kuangjincmb01</td>
						<td>
							<input
								type="text"
								class="table-input"
								value="500000"
								data-field="equity"
							/>
						</td>
						<td>
							<input
								type="number"
								class="table-input"
								data-field="weight"
								value="20"
								min="0"
								max="100"
								step="0.01"
								readonly
							/>
						</td>
						<td>
							<button type="button" class="btn-text" data-action="editRow">
								ç¼–è¾‘
							</button>
							<button type="button" class="btn-text" data-action="deposit">
								å…¥é‡‘
							</button>
							<button type="button" class="btn-text-danger" data-action="removeRow">
								ç§»é™¤
							</button>
						</td>
					</tr>
					<tr data-row-id="2">
						<td>CU</td>
						<td>Kuangjinzx05</td>
						<td>Kuangjincmb01</td>
						<td>Kuangjincmb01</td>
						<td>
							<input
								type="text"
								class="table-input"
								value="500000"
								data-field="equity"
							/>
						</td>
						<td>
							<input
								type="number"
								class="table-input"
								data-field="weight"
								value="20"
								min="0"
								max="100"
								step="0.01"
								readonly
							/>
						</td>
						<td>
							<button type="button" class="btn-text" data-action="editRow">
								ç¼–è¾‘
							</button>
							<button type="button" class="btn-text" data-action="deposit">
								å…¥é‡‘
							</button>
							<button type="button" class="btn-text-danger" data-action="removeRow">
								ç§»é™¤
							</button>
						</td>
					</tr>
					<tr data-row-id="3">
						<td>FG</td>
						<td>Kuangjinzx08</td>
						<td>Kuangjincmb01</td>
						<td>Kuangjincmb01</td>
						<td>
							<input
								type="text"
								class="table-input"
								value="500000"
								data-field="equity"
							/>
						</td>
						<td>
							<input
								type="number"
								class="table-input"
								data-field="weight"
								value="20"
								min="0"
								max="100"
								step="0.01"
								readonly
							/>
						</td>
						<td>
							<button type="button" class="btn-text" data-action="editRow">
								ç¼–è¾‘
							</button>
							<button type="button" class="btn-text" data-action="deposit">
								å…¥é‡‘
							</button>
							<button type="button" class="btn-text-danger" data-action="removeRow">
								ç§»é™¤
							</button>
						</td>
					</tr>
					<tr data-row-id="4">
						<td>SH</td>
						<td>Kuangjinzx02</td>
						<td>Kuangjincmb01</td>
						<td>Kuangjincmb01</td>
						<td>
							<input
								type="text"
								class="table-input"
								value="500000"
								data-field="equity"
							/>
						</td>
						<td>
							<input
								type="number"
								class="table-input"
								data-field="weight"
								value="20"
								min="0"
								max="100"
								step="0.01"
								readonly
							/>
						</td>
						<td>
							<button type="button" class="btn-text" data-action="editRow">
								ç¼–è¾‘
							</button>
							<button type="button" class="btn-text" data-action="deposit">
								å…¥é‡‘
							</button>
							<button type="button" class="btn-text-danger" data-action="removeRow">
								ç§»é™¤
							</button>
						</td>
					</tr>
					<tr data-row-id="5">
						<td>A</td>
						<td>Kuangjinzx04</td>
						<td>Kuangjincmb01</td>
						<td>Kuangjincmb01</td>
						<td>
							<input
								type="text"
								class="table-input"
								value="500000"
								data-field="equity"
							/>
						</td>
						<td>
							<input
								type="number"
								class="table-input"
								data-field="weight"
								value="20"
								min="0"
								max="100"
								step="0.01"
								readonly
							/>
						</td>
						<td>
							<button type="button" class="btn-text" data-action="editRow">
								ç¼–è¾‘
							</button>
							<button type="button" class="btn-text" data-action="deposit">
								å…¥é‡‘
							</button>
							<button type="button" class="btn-text-danger" data-action="removeRow">
								ç§»é™¤
							</button>
						</td>
					</tr>
					</tbody>
				</table>
				<div class="weight-summary">
					<div class="weight-total" id="weightTotal">
						<span>å½“å‰æƒé‡æ€»å’Œï¼š</span>
						<span class="value" id="weightTotalValue">100%</span>
						<span class="chip-compact" id="weightStatusChip">å·²æ»¡è¶³ 100%</span>
					</div>
					<div>
						<button type="button" class="btn-chip" id="addStrategyBtn">
							+ å¢åŠ å“ç§
						</button>
					</div>
				</div>
			</div>
			<div class="helper-text" style="margin-top:8px;">
				- æƒé‡åˆ†é…ç±»å‹ä¸ºã€Œç­‰æƒã€æ—¶ï¼šéšç€å­è…¿æ–°å¢ / åˆ é™¤è‡ªåŠ¨é‡æ–°å‡åˆ†ï¼Œæƒé‡å€¼ä¸å¯æ‰‹åŠ¨ç¼–è¾‘ã€‚
				<br />
				- æƒé‡åˆ†é…ç±»å‹ä¸ºã€Œè‡ªå®šä¹‰ã€æ—¶ï¼šæ”¯æŒé€è¡Œç¼–è¾‘æƒé‡å€¼ï¼Œéœ€å®æ—¶æ ¡éªŒæ‰€æœ‰å¯ç”¨å­è…¿çš„æƒé‡å’Œ = 100%ï¼Œå¦åˆ™ä¸å…è®¸å‘å¸ƒï¼Œä»…å¯ä¿å­˜è‰ç¨¿ã€‚
			</div>
		</section>

		<!-- 4.4 æ“ä½œä¸çŠ¶æ€æµè½¬ï¼ˆè¡¨å•çº§ï¼‰ -->
		<section class="card" id="actionsCard">
			<div class="card-header">
				<div>
					<div class="card-title">
						æ“ä½œä¸çŠ¶æ€æµè½¬
					</div>
					<div class="card-subtitle">
						ä¿å­˜è‰ç¨¿ vs å‘å¸ƒ / å¯ç”¨çš„æ ¡éªŒå¼ºåº¦ä¸åŒ
					</div>
				</div>
			</div>
			<div class="section-divider"></div>

			<div class="form-row">
				<div class="form-field">
					<div class="label-row">
						<label>è¡¨å•æ“ä½œ</label>
					</div>
					<div class="helper-text">
						åº•éƒ¨ç»Ÿä¸€æä¾›ã€Œä¿å­˜è‰ç¨¿ / å‘å¸ƒ / å–æ¶ˆã€æ“ä½œæŒ‰é’®ã€‚ä¿å­˜è‰ç¨¿ä»…æ ¡éªŒåŸºç¡€å¿…å¡«é¡¹ï¼›å‘å¸ƒéœ€é€šè¿‡å…¨éƒ¨å…³é”®ä¸šåŠ¡è§„åˆ™ã€‚
					</div>
				</div>
				<div class="form-field">
					<div class="label-row">
						<label>çŠ¶æ€è¯´æ˜</label>
					</div>
					<div class="helper-text">
						å½“å‰ç¤ºä¾‹çŠ¶æ€ï¼š
						<span class="badge-warning badge">è‰ç¨¿</span>
						â†’ å‘å¸ƒåçŠ¶æ€å°†å˜æ›´ä¸º
						<span class="badge-success badge">å¯ç”¨</span>
						ï¼Œå¹¶å¯¹å‰ç«¯ç”Ÿæ•ˆã€‚
					</div>
				</div>
			</div>

			<div class="helper-text" style="margin-top:12px;">
				- å¿…å¡«é¡¹ç¼ºå¤±ï¼šåœ¨å¯¹åº”å­—æ®µä¸‹æ–¹ä»¥çº¢è‰²æ–‡æ¡ˆæç¤ºã€‚
				<br />
				- ç»„åˆæƒé‡å¼‚å¸¸ï¼šåœ¨ç»„åˆæ„æˆåŒºæˆ–é¡µé¢é¡¶éƒ¨é›†ä¸­æç¤ºï¼Œä¾‹å¦‚ã€Œæƒé‡æ€»å’Œéœ€ä¸º 100%ï¼Œå½“å‰ä¸º 92%ã€ã€‚
				<br />
				- ä¿å­˜è‰ç¨¿ï¼šå…è®¸å­˜åœ¨é…ç½®ç¼ºå¤±ï¼Œä¾¿äºåˆ†é˜¶æ®µå¡«å†™ã€‚
				<br />
				- å‘å¸ƒ / å¯ç”¨ï¼šæ‰€æœ‰å…³é”®ä¸šåŠ¡è§„åˆ™å¿…é¡»é€šè¿‡æ ¡éªŒï¼Œæ‰å…è®¸å˜æ›´ä¸ºå¯ç”¨çŠ¶æ€ã€‚
			</div>
		</section>

		<!-- åº•éƒ¨æ“ä½œæŒ‰é’®åŒº -->
		<footer class="form-footer">
			<div class="form-footer-inner">
				<div class="footer-left">
					<label class="switch">
						<input type="checkbox" id="switchShowAdvanced" />
						<span class="switch-slider">
							<span class="switch-knob"></span>
						</span>
						<span>ä»…å±•ç¤ºå…³é”®å¿…å¡«é¡¹</span>
					</label>
					<span>Â·</span>
					<span>ä¸Šæ¬¡ä¿å­˜æ—¶é—´ï¼š<span id="lastSavedTime">å°šæœªä¿å­˜</span></span>
				</div>
				<div class="footer-right">
					<button type="button" class="btn btn-ghost" id="cancelBtn">
						å–æ¶ˆ
					</button>
					<button type="button" class="btn btn-secondary" id="saveDraftBtn">
						<span class="icon">ğŸ’¾</span>
						<span>ä¿å­˜è‰ç¨¿</span>
					</button>
					<button type="button" class="btn btn-primary" id="publishBtn">
						<span class="icon">ğŸš€</span>
						<span>å‘å¸ƒ / å¯ç”¨</span>
					</button>
				</div>
			</div>
		</footer>
	</main>
</div>

<!-- å…¥é‡‘å¯¹è¯æ¡† -->
<div class="dialog-backdrop" id="depositDialogBackdrop">
	<div class="dialog">
		<div class="dialog-title">å…¥é‡‘</div>
		<div class="dialog-desc" id="depositDialogDesc">
			ä¸ºå½“å‰ç»„åˆäº§å“å¢åŠ æ€»æƒç›Šï¼ŒåŒæ—¶å¯é€‰æ‹©æ˜¯å¦åŒæ­¥è°ƒæ•´å¯¹åº”å­è…¿æƒç›Šã€‚
		</div>
		<div class="form-field">
			<div class="label-row">
				<label for="depositAmount">
					å…¥é‡‘é‡‘é¢ï¼ˆå…ƒï¼‰<span class="required">*</span>
				</label>
			</div>
			<input
				id="depositAmount"
				class="input"
				type="number"
				min="0"
				step="100"
				placeholder="ä¾‹å¦‚ï¼š100000"
			/>
			<div class="helper-text">
				ç¤ºä¾‹ï¼šè¾“å…¥ 100000ï¼Œç¡®è®¤åæ€»æƒç›Šå°†å¢åŠ  100000
			</div>
			<div class="error-text" data-error-for="depositAmount"></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn btn-ghost" id="depositCancelBtn">
				å–æ¶ˆ
			</button>
			<button type="button" class="btn btn-primary" id="depositConfirmBtn">
				ç¡®å®šå…¥é‡‘
			</button>
		</div>
	</div>
</div>

<!-- å¢åŠ å“ç§å¯¹è¯æ¡†ï¼ˆç¤ºæ„ç®€åŒ–ï¼‰ -->
<div class="dialog-backdrop" id="addStrategyDialogBackdrop">
	<div class="dialog">
		<div class="dialog-title">å¢åŠ ç»„åˆå“ç§</div>
		<div class="dialog-desc">
			æ‰‹å·¥æ·»åŠ æ–°çš„å•è…¿å“ç§åˆ°å½“å‰ç»„åˆä¸­ï¼Œç­‰æƒæ¨¡å¼ä¸‹å°†è‡ªåŠ¨å‡åˆ†æƒé‡ã€‚
		</div>
		<div class="form-field">
			<div class="label-row">
				<label for="newInstrument">
					å•è…¿å“ç§ä»£ç <span class="required">*</span>
				</label>
			</div>
			<input
				id="newInstrument"
				class="input"
				type="text"
				placeholder="ä¾‹å¦‚ï¼šRBã€AG"
			/>
			<div class="error-text" data-error-for="newInstrument"></div>
		</div>
		<div class="form-field">
			<div class="label-row">
				<label for="newProductId">
					å•è…¿äº§å“ID<span class="required">*</span>
				</label>
			</div>
			<input
				id="newProductId"
				class="input"
				type="text"
				placeholder="ä¾‹å¦‚ï¼šKuangjinzx10"
			/>
			<div class="error-text" data-error-for="newProductId"></div>
		</div>
		<div class="form-field">
			<div class="label-row">
				<label for="newEquity">
					æƒç›Šï¼ˆå…ƒï¼‰<span class="required">*</span>
				</label>
			</div>
			<input
				id="newEquity"
				class="input"
				type="number"
				min="0"
				step="100"
				placeholder="ä¾‹å¦‚ï¼š200000"
			/>
			<div class="error-text" data-error-for="newEquity"></div>
			<div class="helper-text">
				å¦‚æœç•™ç©ºå°†é»˜è®¤ä¸å½“å‰å…¶ä»–å­è…¿ä¿æŒæ¥è¿‘è§„æ¨¡
			</div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn btn-ghost" id="addStrategyCancelBtn">
				å–æ¶ˆ
			</button>
			<button type="button" class="btn btn-primary" id="addStrategyConfirmBtn">
				ç¡®å®šæ·»åŠ 
			</button>
		</div>
	</div>
</div>

<!-- å‘å¸ƒç¡®è®¤å¯¹è¯æ¡† -->
<div class="dialog-backdrop" id="publishDialogBackdrop">
	<div class="dialog">
		<div class="dialog-title">ç¡®è®¤å‘å¸ƒç»„åˆäº§å“</div>
		<div class="dialog-warning">
			<div class="icon">âš ï¸</div>
			<div>
				å‘å¸ƒåï¼Œè¯¥ç»„åˆäº§å“å°†å¯¹å‰ç«¯ç”Ÿæ•ˆï¼Œéƒ¨åˆ†åŸºç¡€å­—æ®µå°†ä»…æ”¯æŒåªè¯»æŸ¥çœ‹ã€‚
			</div>
		</div>
		<ul class="dialog-list">
			<li>è¯·ç¡®è®¤åŸºç¡€ä¿¡æ¯å·²å¡«å†™å®Œæ•´ï¼ˆäº§å“åç§°ã€äº§å“ç±»å‹ã€é£é™©ç­‰çº§ã€æ‰€å±ç³»åˆ—ç­‰ï¼‰ã€‚</li>
			<li>ç»„åˆé‡åŒ–äº§å“è¦æ±‚ï¼šæ‰€æœ‰å¯ç”¨å­è…¿çš„æƒé‡æ€»å’Œéœ€ä¸º <strong>100%</strong>ã€‚</li>
			<li>å‘å¸ƒåå¦‚éœ€é‡å¤§è°ƒæ•´ï¼Œå¯èƒ½éœ€è¦é‡æ–°èµ°åˆè§„è¯„å®¡æµç¨‹ã€‚</li>
		</ul>
		<div class="dialog-footer">
			<button type="button" class="btn btn-ghost" id="publishCancelBtn">
				å–æ¶ˆ
			</button>
			<button type="button" class="btn btn-primary" id="publishConfirmBtn">
				ç¡®è®¤å‘å¸ƒ
			</button>
		</div>
	</div>
</div>

<script>
	(function () {
		const $ = (id) => document.getElementById(id);
		const banner = $("banner");
		const bannerMessage = $("bannerMessage");
		const scrollToErrorLink = $("scrollToErrorLink");
		const basicInfoCard = $("basicInfoCard");
		const comboSection = $("comboSection");
		const actionsCard = $("actionsCard");
		const productNameInput = $("productName");
		const productCodeInput = $("productCode");
		const riskLevelSelect = $("riskLevel");
		const productTypeSelect = $("productType");
		const producerInput = $("producer");
		const productLevelSelect = $("productLevel");
		const seriesSelect = $("series");
		const productFormSelect = $("productForm");
		const comboTypeSelect = $("comboType");
		const descriptionInput = $("description");
		const totalEquityInput = $("totalEquity");
		const weightTypeToggle = $("weightTypeToggle");
		const strategyTbody = $("strategyTbody");
		const weightTotal = $("weightTotal");
		const weightTotalValue = $("weightTotalValue");
		const weightStatusChip = $("weightStatusChip");
		const addStrategyBtn = $("addStrategyBtn");
		const switchShowAdvanced = $("switchShowAdvanced");
		const lastSavedTime = $("lastSavedTime");
		const saveDraftBtn = $("saveDraftBtn");
		const publishBtn = $("publishBtn");
		const cancelBtn = $("cancelBtn");
		const statusPill = $("statusPill");
		const statusPillText = $("statusPillText");
		const pageTitleText = $("pageTitleText");

		const depositDialogBackdrop = $("depositDialogBackdrop");
		const depositAmountInput = $("depositAmount");
		const depositCancelBtn = $("depositCancelBtn");
		const depositConfirmBtn = $("depositConfirmBtn");

		const addStrategyDialogBackdrop = $("addStrategyDialogBackdrop");
		const newInstrumentInput = $("newInstrument");
		const newProductIdInput = $("newProductId");
		const newEquityInput = $("newEquity");
		const addStrategyCancelBtn = $("addStrategyCancelBtn");
		const addStrategyConfirmBtn = $("addStrategyConfirmBtn");

		const publishDialogBackdrop = $("publishDialogBackdrop");
		const publishCancelBtn = $("publishCancelBtn");
		const publishConfirmBtn = $("publishConfirmBtn");

		let currentWeightType = "equal"; // equal / custom
		let pendingDepositRow = null;

		function showBanner(type, message, scrollToError) {
			banner.className = "info-banner " + type + " visible";
			bannerMessage.textContent = message;
			if (scrollToError) {
				scrollToErrorLink.style.display = "inline";
			} else {
				scrollToErrorLink.style.display = "none";
			}
		}

		function hideBanner() {
			banner.className = "info-banner";
			bannerMessage.textContent = "";
			scrollToErrorLink.style.display = "none";
		}

		function setFieldError(id, message) {
			const inputEl = $(id);
			const errorEl = document.querySelector('.error-text[data-error-for="' + id + '"]');
			if (!inputEl || !errorEl) return;
			if (message) {
				inputEl.classList.add("error");
				errorEl.textContent = message;
			} else {
				inputEl.classList.remove("error");
				errorEl.textContent = "";
			}
		}

		function clearAllErrors() {
			document
				.querySelectorAll(".input, .select, .textarea")
				.forEach((el) => el.classList.remove("error"));
			document
				.querySelectorAll(".error-text")
				.forEach((el) => (el.textContent = ""));
		}

		function formatNow() {
			const d = new Date();
			const pad = (n) => (n < 10 ? "0" + n : n);
			return (
				d.getFullYear() +
				"-" +
				pad(d.getMonth() + 1) +
				"-" +
				pad(d.getDate()) +
				" " +
				pad(d.getHours()) +
				":" +
				pad(d.getMinutes())
			);
		}

		function parseNumberLike(value) {
			if (value == null) return NaN;
			const cleaned = String(value).replace(/[,\s]/g, "");
			const n = parseFloat(cleaned);
			return isNaN(n) ? NaN : n;
		}

		function recalcWeights() {
			const rows = strategyTbody.querySelectorAll("tr");
			if (!rows.length) {
				weightTotalValue.textContent = "0%";
				weightTotal.classList.remove("ok");
				weightTotal.classList.add("error");
				weightStatusChip.textContent = "æš‚æ— ç»„åˆå­è…¿";
				weightStatusChip.className = "chip-compact error";
				return;
			}

			if (currentWeightType === "equal") {
				const count = rows.length;
				const equalWeight = parseFloat((100 / count).toFixed(2));
				let lastWeight = 100 - equalWeight * (count - 1);
				rows.forEach((row, index) => {
					const input = row.querySelector('input[data-field="weight"]');
					if (!input) return;
					if (index === count - 1) {
						input.value = lastWeight.toFixed(2);
					} else {
						input.value = equalWeight.toFixed(2);
					}
				});
			}

			let total = 0;
			rows.forEach((row) => {
				const input = row.querySelector('input[data-field="weight"]');
				if (!input) return;
				const val = parseFloat(input.value) || 0;
				total += val;
			});

			const rounded = parseFloat(total.toFixed(2));
			weightTotalValue.textContent = rounded.toFixed(2) + "%";

			if (Math.abs(rounded - 100) < 0.01) {
				weightTotal.classList.remove("error");
				weightTotal.classList.add("ok");
				weightStatusChip.textContent =
					currentWeightType === "equal"
						? "ç­‰æƒ Â· å·²è‡ªåŠ¨å‡åˆ†"
						: "è‡ªå®šä¹‰ Â· å·²æ»¡è¶³ 100%";
				weightStatusChip.className = "chip-compact";
			} else {
				weightTotal.classList.remove("ok");
				weightTotal.classList.add("error");
				weightStatusChip.textContent = "å½“å‰ä¸ç­‰äº 100%ï¼Œå‘å¸ƒå‰éœ€ä¿®æ­£";
				weightStatusChip.className = "chip-compact error";
			}
		}

		function setWeightType(type) {
			currentWeightType = type;
			const chips = weightTypeToggle.querySelectorAll(".toggle-chip");
			chips.forEach((chip) => {
				if (chip.dataset.weightType === type) {
					chip.classList.add("active");
				} else {
					chip.classList.remove("active");
				}
			});

			const weightInputs = strategyTbody.querySelectorAll('input[data-field="weight"]');
			weightInputs.forEach((input) => {
				if (type === "equal") {
					input.setAttribute("readonly", "readonly");
				} else {
					input.removeAttribute("readonly");
				}
			});

			recalcWeights();
		}

		function validateBasicForDraft() {
			let ok = true;
			clearAllErrors();
			hideBanner();

			if (!productNameInput.value.trim()) {
				setFieldError("productName", "äº§å“åç§°ä¸ºå¿…å¡«é¡¹");
				ok = false;
			}
			if (!productTypeSelect.value) {
				setFieldError("productType", "è¯·é€‰æ‹©äº§å“ç±»å‹");
				ok = false;
			}
			if (!productFormSelect.value) {
				setFieldError("productForm", "è¯·é€‰æ‹©äº§å“å½¢å¼");
				ok = false;
			}
			if (!comboTypeSelect.value) {
				setFieldError("comboType", "è¯·é€‰æ‹©ç»„åˆç±»å‹");
				ok = false;
			}

			if (!ok) {
				showBanner("error", "è¯·å…ˆè¡¥å…¨åŸºç¡€å¿…å¡«é¡¹åå†ä¿å­˜è‰ç¨¿ã€‚", true);
			}
			return ok;
		}

		function validateForPublish() {
			let ok = true;
			clearAllErrors();
			hideBanner();

			if (!productNameInput.value.trim()) {
				setFieldError("productName", "äº§å“åç§°ä¸ºå¿…å¡«é¡¹");
				ok = false;
			}
			if (!riskLevelSelect.value) {
				setFieldError("riskLevel", "è¯·é€‰æ‹©é£é™©ç­‰çº§");
				ok = false;
			}
			if (!productTypeSelect.value) {
				setFieldError("productType", "è¯·é€‰æ‹©äº§å“ç±»å‹");
				ok = false;
			}
			if (!producerInput.value.trim()) {
				setFieldError("producer", "è¯·å¡«å†™äº§å“å‡ºå“äºº");
				ok = false;
			}
			if (!seriesSelect.value) {
				setFieldError("series", "è¯·é€‰æ‹©æ‰€å±ç³»åˆ—");
				ok = false;
			}
			if (!productFormSelect.value) {
				setFieldError("productForm", "è¯·é€‰æ‹©äº§å“å½¢å¼");
				ok = false;
			}
			if (!comboTypeSelect.value) {
				setFieldError("comboType", "è¯·é€‰æ‹©ç»„åˆç±»å‹");
				ok = false;
			}
			if (!descriptionInput.value.trim()) {
				setFieldError("description", "è¯·å¡«å†™äº§å“ç®€ä»‹");
				ok = false;
			}

			// ç»„åˆé€»è¾‘æ ¡éªŒ
			if (
				productFormSelect.value === "ç»„åˆç­–ç•¥" &&
				comboTypeSelect.value === "type1"
			) {
				const rows = strategyTbody.querySelectorAll("tr");
				if (!rows.length) {
					ok = false;
					showBanner(
						"error",
						"ç»„åˆé‡åŒ–äº§å“è‡³å°‘éœ€è¦é…ç½®ä¸€æ¡å¯ç”¨å­è…¿ï¼Œè¯·å…ˆåœ¨ã€Œç»„åˆæ„æˆä¸æƒé‡ã€ä¸­å¢åŠ å“ç§ã€‚",
						true
					);
					return false;
				}
				let total = 0;
				rows.forEach((row) => {
					const input = row.querySelector('input[data-field="weight"]');
					if (!input) return;
					const val = parseFloat(input.value) || 0;
					total += val;
				});
				const rounded = parseFloat(total.toFixed(2));
				if (Math.abs(rounded - 100) >= 0.01) {
					ok = false;
					showBanner(
						"error",
						`æƒé‡æ€»å’Œéœ€ä¸º 100%ï¼Œå½“å‰ä¸º ${rounded.toFixed(
							2
						)}%ã€‚è¯·åœ¨ã€Œç»„åˆæ„æˆä¸æƒé‡ã€åŒºå—è°ƒæ•´åå†å‘å¸ƒã€‚`,
						true
					);
				}
			}

			if (!ok && !bannerMessage.textContent) {
				showBanner("error", "è¯·å…ˆä¿®æ­£é¡µé¢ä¸­çš„çº¢è‰²é”™è¯¯æç¤ºåå†å‘å¸ƒã€‚", true);
			}
			return ok;
		}

		function smoothScrollTo(el) {
			if (!el) return;
			const rect = el.getBoundingClientRect();
			const absoluteY = rect.top + window.scrollY;
			const offset = 80;
			window.scrollTo({
				top: absoluteY - offset,
				behavior: "smooth"
			});
		}

		function openDepositDialog(row) {
			pendingDepositRow = row;
			depositAmountInput.value = "";
			setFieldError("depositAmount", "");
			depositDialogBackdrop.classList.add("visible");
			depositAmountInput.focus();
		}

		function closeDepositDialog() {
			depositDialogBackdrop.classList.remove("visible");
			pendingDepositRow = null;
		}

		function openAddStrategyDialog() {
			newInstrumentInput.value = "";
			newProductIdInput.value = "";
			newEquityInput.value = "";
			setFieldError("newInstrument", "");
			setFieldError("newProductId", "");
			setFieldError("newEquity", "");
			addStrategyDialogBackdrop.classList.add("visible");
			newInstrumentInput.focus();
		}

		function closeAddStrategyDialog() {
			addStrategyDialogBackdrop.classList.remove("visible");
		}

		function openPublishDialog() {
			publishDialogBackdrop.classList.add("visible");
		}

		function closePublishDialog() {
			publishDialogBackdrop.classList.remove("visible");
		}

		// ç»‘å®šæƒé‡ç±»å‹åˆ‡æ¢
		weightTypeToggle.addEventListener("click", (e) => {
			const chip = e.target.closest(".toggle-chip");
			if (!chip) return;
			const type = chip.dataset.weightType;
			if (!type || type === currentWeightType) return;
			setWeightType(type);
		});

		// è¡¨æ ¼ä¸­çš„æŒ‰é’®äº‹ä»¶ï¼ˆç¼–è¾‘ / å…¥é‡‘ / ç§»é™¤ï¼‰
		strategyTbody.addEventListener("click", (e) => {
			const btn = e.target.closest("button");
			if (!btn) return;
			const action = btn.dataset.action;
			const row = btn.closest("tr");
			if (!row || !action) return;

			if (action === "editRow") {
				// ç®€åŒ–ï¼šæ¨¡æ‹Ÿã€Œç¼–è¾‘ã€è¡Œä¸ºï¼Œèšç„¦åˆ°å½“å‰è¡Œæƒé‡è¾“å…¥æ¡†
				const equityInput = row.querySelector('input[data-field="equity"]');
				if (equityInput) equityInput.focus();
			} else if (action === "deposit") {
				openDepositDialog(row);
			} else if (action === "removeRow") {
				row.remove();
				recalcWeights();
			}
		});

		// è‡ªå®šä¹‰æƒé‡æ—¶ï¼Œå®æ—¶é‡ç®—
		strategyTbody.addEventListener("input", (e) => {
			const target = e.target;
			if (!target.matches('input[data-field="weight"]')) return;
			if (currentWeightType !== "custom") return;
			recalcWeights();
		});

		// å…¥é‡‘å¯¹è¯æ¡†äº¤äº’
		depositCancelBtn.addEventListener("click", () => {
			closeDepositDialog();
		});

		depositConfirmBtn.addEventListener("click", () => {
			const raw = depositAmountInput.value.trim();
			const amount = parseNumberLike(raw);
			if (!raw || isNaN(amount) || amount <= 0) {
				setFieldError("depositAmount", "è¯·è¾“å…¥å¤§äº 0 çš„å…¥é‡‘é‡‘é¢");
				return;
			}
			setFieldError("depositAmount", "");

			const currentEquity = parseNumberLike(totalEquityInput.value) || 0;
			totalEquityInput.value = Math.round(currentEquity + amount);

			if (pendingDepositRow) {
				const equityInput = pendingDepositRow.querySelector(
					'input[data-field="equity"]'
				);
				if (equityInput) {
					const oldVal = parseNumberLike(equityInput.value) || 0;
					equityInput.value = Math.round(oldVal + amount);
				}
			}
			closeDepositDialog();
			showBanner(
				"success",
				"å…¥é‡‘æˆåŠŸï¼Œå·²æ›´æ–°æ€»æƒç›Šå’Œå¯¹åº”å­è…¿æƒç›Šï¼ˆç¤ºæ„äº¤äº’ï¼‰ã€‚",
				false
			);
		});

		// å¢åŠ å“ç§å¯¹è¯æ¡†äº¤äº’
		addStrategyBtn.addEventListener("click", () => {
			openAddStrategyDialog();
		});

		addStrategyCancelBtn.addEventListener("click", () => {
			closeAddStrategyDialog();
		});

		addStrategyConfirmBtn.addEventListener("click", () => {
			let ok = true;
			if (!newInstrumentInput.value.trim()) {
				setFieldError("newInstrument", "è¯·å¡«å†™å•è…¿å“ç§ä»£ç ");
				ok = false;
			} else {
				setFieldError("newInstrument", "");
			}
			if (!newProductIdInput.value.trim()) {
				setFieldError("newProductId", "è¯·å¡«å†™å•è…¿äº§å“ID");
				ok = false;
			} else {
				setFieldError("newProductId", "");
			}
			const equityVal = newEquityInput.value.trim();
			const equityNum = parseNumberLike(equityVal);
			if (!equityVal || isNaN(equityNum) || equityNum <= 0) {
				setFieldError("newEquity", "è¯·è¾“å…¥æœ‰æ•ˆçš„æƒç›Šæ•°å€¼");
				ok = false;
			} else {
				setFieldError("newEquity", "");
			}
			if (!ok) return;

			const nextId =
				Math.max(
					0,
					...Array.from(strategyTbody.querySelectorAll("tr")).map((tr) =>
						parseInt(tr.dataset.rowId || "0", 10)
					)
				) + 1;

			const tr = document.createElement("tr");
			tr.dataset.rowId = String(nextId);
			tr.innerHTML = `
				<td>${newInstrumentInput.value.trim()}</td>
				<td>${newProductIdInput.value.trim()}</td>
				<td>Kuangjincmb01</td>
				<td>Kuangjincmb01</td>
				<td>
					<input
						type="text"
						class="table-input"
						value="${Math.round(equityNum)}"
						data-field="equity"
					/>
				</td>
				<td>
					<input
						type="number"
						class="table-input"
						data-field="weight"
						value="0"
						min="0"
						max="100"
						step="0.01"
						${currentWeightType === "equal" ? "readonly" : ""}
					/>
				</td>
				<td>
					<button type="button" class="btn-text" data-action="editRow">
						ç¼–è¾‘
					</button>
					<button type="button" class="btn-text" data-action="deposit">
						å…¥é‡‘
					</button>
					<button type="button" class="btn-text-danger" data-action="removeRow">
						ç§»é™¤
					</button>
				</td>
			`;
			strategyTbody.appendChild(tr);

			closeAddStrategyDialog();
			recalcWeights();
			showBanner(
				"success",
				"å·²æ–°å¢ç»„åˆå“ç§ï¼Œç­‰æƒæ¨¡å¼ä¸‹ç³»ç»Ÿå·²è‡ªåŠ¨é‡æ–°åˆ†é…æƒé‡ã€‚",
				false
			);
		});

		// å‘å¸ƒå‰æ£€æŸ¥ + æ‰“å¼€å‘å¸ƒç¡®è®¤å¼¹çª—
		publishBtn.addEventListener("click", () => {
			const ok = validateForPublish();
			if (!ok) return;
			openPublishDialog();
		});

		// å‘å¸ƒç¡®è®¤å¼¹çª—äº¤äº’
		publishCancelBtn.addEventListener("click", () => {
			closePublishDialog();
		});

		publishConfirmBtn.addEventListener("click", () => {
			closePublishDialog();
			const now = formatNow();
			lastSavedTime.textContent = now;
			statusPillText.textContent = "å·²å‘å¸ƒ Â· å¯ç”¨ä¸­";
			statusPill.style.background = "#e8f5e9";
			statusPill.style.color = "#2e7d32";
			statusPill.querySelector(".status-dot").style.background = "#2e7d32";
			showBanner(
				"success",
				"å·²å‘å¸ƒæˆåŠŸï¼Œå½“å‰äº§å“çŠ¶æ€ä¸ºã€Œå¯ç”¨ã€ï¼Œå‰ç«¯å°†æŒ‰æœ€æ–°é…ç½®å±•ç¤ºï¼ˆç¤ºæ„ï¼‰ã€‚",
				false
			);
			productCodeInput.setAttribute("readonly", "readonly");
		});

		// ä¿å­˜è‰ç¨¿
		saveDraftBtn.addEventListener("click", () => {
			const ok = validateBasicForDraft();
			if (!ok) return;
			const now = formatNow();
			lastSavedTime.textContent = now;
			statusPillText.textContent = "è‰ç¨¿ Â· æœªå‘å¸ƒ";
			statusPill.style.background = "#fff3e0";
			statusPill.style.color = "#ef6c00";
			statusPill.querySelector(".status-dot").style.background = "#ef6c00";
			showBanner(
				"success",
				"è‰ç¨¿å·²ä¿å­˜ã€‚å…è®¸åç»­ç»§ç»­è¡¥å…¨é…ç½®ï¼Œå†è¿›è¡Œå‘å¸ƒæ“ä½œã€‚",
				false
			);
		});

		// å–æ¶ˆæŒ‰é’®ï¼šç¤ºæ„è¿”å›ä¸Šä¸€é¡µ
		cancelBtn.addEventListener("click", () => {
			if (
				confirm(
					"å­˜åœ¨å¯èƒ½å°šæœªä¿å­˜çš„ä¿®æ”¹ï¼Œç¡®å®šè¦è¿”å›äº§å“åˆ—è¡¨å—ï¼Ÿï¼ˆæ­¤ä¸ºåŸå‹äº¤äº’ç¤ºæ„ï¼Œä¸ä¼šå®é™…è·³è½¬ï¼‰"
				)
			) {
				showBanner(
					"info",
					"å·²å–æ¶ˆæœ¬æ¬¡ç¼–è¾‘ï¼ˆåŸå‹ç¤ºæ„ï¼‰ã€‚åœ¨çœŸå®ç³»ç»Ÿä¸­å°†è¿”å›åˆ°ç»„åˆäº§å“åˆ—è¡¨é¡µã€‚",
					false
				);
			}
		});

		// é¡¶éƒ¨ banner çš„ã€ŒæŸ¥çœ‹è¯¦æƒ…ã€ï¼šæ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯å­—æ®µæ‰€åœ¨åŒºå—
		scrollToErrorLink.addEventListener("click", () => {
			const errorField = document.querySelector(".input.error, .select.error, .textarea.error");
			if (errorField) {
				smoothScrollTo(errorField.closest(".card") || errorField);
			} else {
				smoothScrollTo(comboSection);
			}
		});

		// é¡¶éƒ¨æ ‡é¢˜è·Ÿéšäº§å“åç§°å˜åŒ–ï¼ˆç¤ºæ„ï¼‰
		productNameInput.addEventListener("input", () => {
			pageTitleText.textContent =
				productNameInput.value.trim() || "ç»„åˆäº§å“ç¼–è¾‘";
		});

		// ã€Œä»…å±•ç¤ºå…³é”®å¿…å¡«é¡¹ã€å¼€å…³ï¼ˆç¤ºæ„éšè—éƒ¨åˆ†å­—æ®µï¼‰
		switchShowAdvanced.addEventListener("change", () => {
			const showOnlyRequired = switchShowAdvanced.checked;
			const optionalSelectors = [
				"#productLevel",
				"#description",
				"#totalEquity",
				"#shareAmount",
				"#nav"
			];
			optionalSelectors.forEach((id) => {
				const field = $(id);
				if (!field) return;
				const container = field.closest(".form-field");
				if (!container) return;
				container.style.display = showOnlyRequired ? "none" : "";
			});
		});

		// åˆå§‹åŒ–
		setWeightType("equal");
		recalcWeights();
	})();
</script>
</body>
</html>
